<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>freshchat</title>

    <!----======== CSS ======== -->
    <link rel="stylesheet" href="../assets/css/style.css" />
    <link rel="stylesheet" href="../assets/css/chat.css" />

    <!----===== Boxicons CSS ===== -->
    <link
      href="https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css"
      rel="stylesheet"
    />

    <script
      src="https://kit.fontawesome.com/a06ff6477a.js"
      crossorigin="anonymous"
    ></script>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"
    />
  </head>

  <body>
    <nav class="sidebar close">
      <header>
        <div class="image-text">
          <span class="image">
            <img id="profile-image" src="" alt="profile-image" />
          </span>

          <div class="text logo-text">
            <span class="name">Codinglab</span>
            <span class="profession">Web developer</span>
          </div>
        </div>

        <i class="bx bx-chevron-right toggle"></i>
      </header>

      <div class="menu-bar">
        <div class="menu">
          <ul class="menu-links">
            <li class="nav-link" id="home">
              <i class="bi bi-person-badge-fill icon"></i>
              <span class="text nav-text">Dashboard</span>
            </li>

            <li class="nav-link" id="chat">
              <i class="bi bi-chat-right icon"></i>
              <span class="text nav-text">freshChat</span>
            </li>

            <li class="nav-link" id="camera">
              <i class="bi bi-camera icon"></i>
              <span class="text nav-text">fresh cam</span>
            </li>

            <li class="nav-link" id="invite">
              <i class="fa-brands fa-battle-net icon"></i>
              <span class="text nav-text">fresh invite</span>
            </li>

            <li class="nav-link" id="notification">
              <i class="bx bx-bell icon"></i>
              <span class="text nav-text">Notification</span>
            </li>

            <li class="nav-link" id="setting">
              <i class="bi bi-gear icon"></i>
              <span class="text nav-text">Setting</span>
            </li>
          </ul>
        </div>

        <ul class="bottom-content">
          <li class="logOut">
            <i class="bx bx-log-out icon"></i>
            <span class="text nav-text">Logout</span>
          </li>

          <li class="mode">
            <div class="sun-moon">
              <i class="bx bx-moon icon moon"></i>
              <i class="bx bx-sun icon sun"></i>
            </div>
            <span class="mode-text text">Dark mode</span>

            <div class="toggle-switch">
              <span class="switch"></span>
            </div>
          </li>
        </ul>
      </div>
    </nav>

    <section class="section-container">
      <div class="text-section-container">
        <div class="chat-member-left-container">
          <div class="chat-inside-member-left-div">
            <!-- search bar -->

            <!-- reels -->
            <div class="whole-reel-container">
              <!-- Reel and setting -->

              <div class="reel-inside-div-container">
                <!-- add reel  -->

                <div class="add-reel-div">
                  <p class="add">Add</p>
                  <input type="file" id="file" class="reel-input" />
                  <label for="file"> <i class="bi bi-bookmark-plus"></i></label>
                </div>

                <!-- reel profile -->
                <div class="reel-container"></div>
              </div>
            </div>

            <!-- chat member area -->

            <div class="message-member-and-add-div-container">
              <!-- chatter person adding option div -->

              <div class="message-member-container">
                <div class="message-input-select-div-container">
                  <div class="add-member-head-div">
                    <h3 class="select-member-head">Select friends</h3>
                  </div>

                  <div class="input-button-div">
                    <input class="search-input" type="text" />
                    <button class="search-button">
                      <i class="bi bi-search"></i>
                    </button>
                  </div>
                </div>
                <!-- message setting div -->

                <div class="chat-member-container">
                  <div class="chat-member-inside-div-container">
                    <div class="chat-member-inside-container"></div>
                  </div>
                </div>
                <div class="showing-all-members-div-container">
                  <div class="showing-member-div"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- chat area box -->

        <div class="chat-box-container">
          <div class="chat-box-inside-container">
            <!-- chat profile are -->
            <div class="chat-member-option-div"></div>

            <!-- chat showing message box css -->

            <div class="chat-place-container">
              <div class="chat-place-div">
                <div class="right-side-container"></div>
              </div>
            </div>
            <!-- chat message input container css -->

            <div class="chat-input-option-div"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- scripts link source -->
    <script src="../assets/js/side-bar.js"></script>
    <script src="https://momentjs.com/downloads/moment.js"></script>
    <script src="../assets/js/profile_user_find.js"></script>
    <script src="../assets/js/page-direction.js"></script>
    <!-- <script src="../assets/js/search_filter.js"></script> -->
    <!-- <script src="../assets/js/reel_access.js"></script> -->

    <link
      href="https://cdn.jsdelivr.net/npm/openmoji@latest/openmoji.min.css"
      rel="stylesheet"
    />

    <script src="../assets/js/add_user_friends.js"></script>
    <script src="../assets/js/search_filter.js"></script>
    <script type="module" src="../assets/js/db.js"></script>
    <script type="module" src="../assets/js/chatUserSelector.js"></script>

    <!-- <script
      src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js"
      crossorigin="anonymous"
    ></script> -->
    <!-- <script src="../assets/js/emoji.js"></script> -->

    <!-- <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js";
      import {
        getDatabase,
        set,
        ref,
        onValue,
        push,
      } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-database.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyByvONF3f6-tLWrigL42gKw2hGQxtbmYWc",
        authDomain: "freshchat-28154.firebaseapp.com",
        databaseURL: "https://freshchat-28154-default-rtdb.firebaseio.com",
        projectId: "freshchat-28154",
        storageBucket: "freshchat-28154.appspot.com",
        messagingSenderId: "469786534443",
        appId: "1:469786534443:web:ab0252cf738142d649806e",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);

      let database = getDatabase();

      // getting data function from the database

      let firebaseDatabaseData = [];

      function getData() {
        onValue(ref(database, `freshchat/`), (snapshot) => {
          if (snapshot.val() == null) {
            return;
          }
          let firebaseDatabaseData = Object.values(snapshot.val());

          console.log(firebaseDatabaseData[0]["chat"]);
          // Element creatin for the chat elment
          console.log(firebaseDatabaseData);

          for (let j = 0; j < firebaseDatabaseData.length; j++) {
            if (
              firebaseDatabaseData[j]["chatReceiverId"] !== userSelectId &&
              firebaseDatabaseData[j]["chatSenderId"] === findUser["userId"]
            ) {
              let chatDivUser = document.createElement("div");
              chatDivUser.setAttribute("class", "chat-div-for-user");

              let chatUserInsideDiv = document.createElement("div");
              chatUserInsideDiv.setAttribute("class", "chat-user-inside-div");
              chatDivUser.append(chatUserInsideDiv);

              let chatDiv = document.createElement("div");
              chatDiv.setAttribute("class", "chat-div");
              chatUserInsideDiv.append(chatDiv);

              let chatInsideDiv = document.createElement("div");
              chatInsideDiv.setAttribute("class", "chat-inside-div");
              chatDiv.append(chatInsideDiv);

              let chatContentTimeDiv = document.createElement("div");
              chatContentTimeDiv.setAttribute("class", "chat-content-time-div");
              chatInsideDiv.append(chatContentTimeDiv);

              let chatContentTimeInsideDiv = document.createElement("div");
              chatContentTimeInsideDiv.setAttribute(
                "class",
                "chat-content-time-inside-div"
              );
              chatContentTimeDiv.append(chatContentTimeInsideDiv);

              let chatContentDiv = document.createElement("div");
              chatContentDiv.setAttribute("class", "chat-content-div");
              chatContentTimeInsideDiv.append(chatContentDiv);

              let chatContent = document.createElement("p");
              chatContent.setAttribute("class", "chat-content");
              chatContent.innerHTML = firebaseDatabaseData[j]["chat"];
              chatContentDiv.append(chatContent);

              let chatTimeDiv = document.createElement("div");
              chatTimeDiv.setAttribute("class", "chat-time-div");
              chatContentTimeInsideDiv.append(chatTimeDiv);

              let timePara = document.createElement("p");
              timePara.setAttribute("class", "time-para");
              timePara.innerHTML = firebaseDatabaseData[j]["chatTime"];
              chatTimeDiv.append(timePara);

              let userProfileDiv = document.createElement("div");
              userProfileDiv.setAttribute("class", "user-profile-div");
              chatInsideDiv.append(userProfileDiv);

              let usrImage = document.createElement("img");
              usrImage.setAttribute("alt", "chat-image");
              usrImage.setAttribute("class", "chatter-image");
              usrImage.setAttribute("src", findUser["avatarUrl"]);
              userProfileDiv.append(usrImage);

              document
                .querySelector(".right-side-container")
                .append(chatDivUser);
            } else {
              console.log("friends");
              let chatDivUser = document.createElement("div");
              chatDivUser.setAttribute("class", "chat-div-for-user");

              let chatUserInsideDiv = document.createElement("div");
              chatUserInsideDiv.setAttribute(
                "class",
                "chat-friends-inside-div"
              );
              chatDivUser.append(chatUserInsideDiv);

              let chatDiv = document.createElement("div");
              chatDiv.setAttribute("class", "chat-div");
              chatUserInsideDiv.append(chatDiv);

              let chatInsideDiv = document.createElement("div");
              chatInsideDiv.setAttribute("class", "chat-inside-div");
              chatDiv.append(chatInsideDiv);

              let userProfileDiv = document.createElement("div");
              userProfileDiv.setAttribute("class", "user-profile-div");
              chatInsideDiv.append(userProfileDiv);

              let usrImage = document.createElement("img");
              usrImage.setAttribute("alt", "chat-image");
              usrImage.setAttribute("class", "chatter-image");
              usrImage.setAttribute(
                "src",
                firebaseDatabaseData[j]["chatReceiverImage"]
              );
              userProfileDiv.append(usrImage);

              let chatContentTimeDiv = document.createElement("div");
              chatContentTimeDiv.setAttribute("class", "chat-content-time-div");
              chatInsideDiv.append(chatContentTimeDiv);

              let chatContentTimeInsideDiv = document.createElement("div");
              chatContentTimeInsideDiv.setAttribute(
                "class",
                "chat-content-time-inside-div"
              );
              chatContentTimeDiv.append(chatContentTimeInsideDiv);

              let chatContentDiv = document.createElement("div");
              chatContentDiv.setAttribute("class", "chat-content-div");
              chatContentTimeInsideDiv.append(chatContentDiv);

              let chatContent = document.createElement("p");
              chatContent.setAttribute("class", "chat-content");
              chatContent.innerHTML = firebaseDatabaseData[j]["chat"];
              chatContentDiv.append(chatContent);

              let chatTimeDiv = document.createElement("div");
              chatTimeDiv.setAttribute("class", "chat-time-div");
              chatContentTimeInsideDiv.append(chatTimeDiv);

              let timePara = document.createElement("p");
              timePara.setAttribute("class", "time-para");
              timePara.innerHTML = firebaseDatabaseData[j]["chatTime"];
              chatTimeDiv.append(timePara);

              document
                .querySelector(".right-side-container")
                .append(chatDivUser);
            }
          }
        });
      }
      getData();

      // set the data to the firebase

      let firstParent = document.querySelector(".chat-input-option-div");

      async function setData(userReceiver) {
        let chatReceiverId = userReceiver;
        let chatMessage = document.querySelector("#chat-input").value.trim();
        console.log(chatMessage);

        let userName = findUser["userName"];
        console.log(userName);

        let personId = findUser["userId"];

        let chatId = moment().format("LT");
        let dateChat = moment().format("l");

        // Generate a new unique key using push()
        let chatRef = push(ref(database, "freshchat/"));

        let chatData = {
          chatPerson: userName,
          chat: chatMessage,
          chatTime: chatId,
          chatReceiverId: chatReceiverId,
          chatDate: dateChat,
          chatSenderId: personId,
          chatSenderImage: findUser["avatarUrl"],
        };

        try {
          await set(chatRef, chatData);
          console.log("Data updated successfully!");
          // Proceed with further actions or data retrieval here
        } catch (error) {
          console.error("Error updating data:", error);
        }
      }

      // Attach the click event listener to the document object using event delegation
      firstParent.addEventListener("click", function (event) {
        let target = event.target;

        console.log(target);

        let userReceiver = target.id;
        // Check if the event target is the chat-submit button inside the chat-submit-button-div
        if (target.matches(".submit-span")) {
          setData(userReceiver);
        }
      });

      // update the firebase database
    </script> -->

    <!-- <script src="../assets/js/freshchat.js"></script> -->
  </body>
</html>
